# SILAM Pollen Allergy Sensor for Home Assistant

Интеграция для Home Assistant, использующая набор данных `"Лучший временной ряд, полученный из последнего доступного прогона."` с сервера SILAM Thredds server для создания службы с сенсорами уровня пыльцы для конкретного местоположения. Расчет прогноза производится Finnish Meteorological Institute с учетом данных аэробиологических, фенологических и метеорологических наблюдений.

Источник данных: [https://silam.fmi.fi/pollen.html](https://silam.fmi.fi/pollen.html)

> [!CAUTION]  
> Предоставленные данные являются непроверенными модельными прогнозами, созданными только для научного использования.
> Ни качество, ни полнота представленной информации не гарантируются, и производители данных не несут никакой ответственности за её правильность и своевременность.

> [!IMPORTANT]  
> Эта интеграция создана с использованием редакции ChatGPT для совместного написания кода, исправления ошибок и редактуры.
> Если вы придерживаетесь иной этической точки зрения, приношу извинения. Однако, я считаю, что данное применение является морально приемлемым, поскольку интеграция является некоммерческой, бесплатной и свободной, а её цель — способствовать открытости и взаимодействию.

## Описание

Интеграция **SILAM Pollen** предоставляет службу, состоящую из сенсоров, которая динамически формирует URL для запроса данных о пыльце. Данные запрашиваются с сервера SILAM с помощью HTTP-запроса, затем парсятся и обновляются в Home Assistant. Можно создавать несколько служб для разных местоположений, а также предоставляется возможность выбора необходимых типов пыльцы.

## Установка

### Ручная установка

1. Скопируйте папку `silam_pollen` в каталог `custom_components` вашей конфигурации Home Assistant.
2. Перезапустите Home Assistant.
3. Добавьте интеграцию через веб-интерфейс:
   - Перейдите в **Настройки → Интеграции**.
   - Нажмите **Добавить интеграцию** и выберите **SILAM Pollen**.
   - Заполните необходимые поля (например, имя, координаты, высоту, выбор типа пыльцы, интервал опроса).

### Инструкция по добавлению интеграции через HACS

Следуйте этим шагам, чтобы добавить интеграцию **SILAM Pollen** через HACS:

1. **Убедитесь, что HACS установлен:**
   - Если HACS ещё не установлен, следуйте [официальной инструкции по установке HACS](https://hacs.xyz/docs/installation/installation).

2. **Откройте Home Assistant и перейдите в HACS:**
   - На боковой панели найдите и нажмите на значок HACS.

3. **Добавление пользовательского репозитория:**
   - В HACS перейдите на вкладку **Интеграции**.
   - Нажмите кнопку **Добавить пользовательский репозиторий** (Custom Repositories).
   - В появившемся окне введите URL репозитория:  
     `https://github.com/danishru/silam_pollen`
   - Выберите тип репозитория **Integration**.
   - Нажмите **Добавить**.

4. **Установка интеграции:**
   - После добавления репозитория HACS автоматически обнаружит релиз вашей интеграции.
   - В разделе **Интеграции** появится интеграция с именем **SILAM Pollen**.
   - Найдите её и нажмите **Установить**.
   - Дождитесь завершения установки.

5. **Настройка интеграции:**
   - После установки перейдите в **Настройки → Интеграции** Home Assistant.
   - Найдите **SILAM Pollen** и следуйте инструкциям мастера настройки.

Теперь ваша интеграция установлена и готова к использованию через HACS!

## Конфигурация

При настройке интеграции через веб-интерфейс доступны следующие параметры:

- **Зона наблюдения** – позволяет выбрать настроенную зону в вашем Home Assistant. По умолчанию выбирается зона `"Home"`.
- **Тип пыльцы** – выбор наблюдаемой пыльцы. Можно не выбирать ни один тип или выбрать несколько из списка.
- **Интервал обновления** – интервал загрузки данных с сервера SILAM Thredds server в минутах (по умолчанию 60, минимальное значение — 30 минут).
- **Название зоны** – по умолчанию используется название из выбранной зоны. Это имя используется для формирования названий служб и сенсоров. Параметр можно переопределить.
- **Высота над уровнем моря** – высота над уровнем моря, используемая для выборки данных об уровне пыльцы из набора данных. Если выбрана зона `"Home"`, данные берутся из общих настроек (`config/general`); в ином случае по умолчанию устанавливается значение 275. Параметр можно переопределить.
- **Местоположение** – отображает на карте местоположение выбранной зоны. Зону наблюдения можно изменить с помощью карты или вручную задать координаты "Широта" и "Долгота". Указанный радиус отражает примерное пространственное разрешение данных о пыльце (около 10 км).

## Использование

После установки интеграции в Home Assistant создается служба с именем `SILAM Pollen - {Название зоны}`. В описании службы указываются координаты местоположения наблюдения и версия используемого набора данных.

![image](https://github.com/user-attachments/assets/e8c3c44d-d98d-44ee-85c7-bac838df7094)


В рамках службы создается сенсор **Индекс пыльцы**, состояние которого отображает локализованное значение, соответствующее числовому индексу, рассчитанному на основе почасовых средних значений и пороговых значений из справочной таблицы Mikhail Sofiev ([ссылка](https://www.researchgate.net/profile/Mikhail-Sofiev)). Возможные значения индекса:
- 1 – Очень низкий
- 2 – Низкий
- 3 – Средний
- 4 – Высокий
- 5 – Очень высокий
- Если значение не соответствует ни одному из указанных уровней, отображается «Неизвестно».

Дополнительно в атрибуты сенсора записываются дата прогноза и основной аллерген, оказывающий существенное влияние на формирование индекса.

Если выбран тип пыльцы, то для каждого выбранного типа создается отдельный сенсор, отображающий округленное до целого число, представляющее смоделированное количество пыльцы (единиц на кубический метр). В атрибутах таких сенсоров также указывается ближайшая доступная высота над уровнем моря, которая использовалась для выборки данных.

|  ![image](https://github.com/user-attachments/assets/b5d990c6-3d0b-4dcb-a191-7c15a77fe8f7) | ![image](https://github.com/user-attachments/assets/aacafdae-07c3-48ce-8aa3-f31e3e9932a6)  |
| ------------- | ------------- |

## Лицензия

[MIT License](LICENSE)

## Поддержка

Если возникнут вопросы или проблемы, создайте issue в [репозитории](https://github.com/danishru/silam_pollen/issues).
